diff --git a/ext/exif/exif.c b/ext/exif/exif.c
index 78269b9a927c..e04290376ce5 100644
--- a/ext/exif/exif.c
+++ b/ext/exif/exif.c
@@ -3920,6 +3920,8 @@ static int exif_scan_thumbnail(image_info_type *ImageInfo)
 		if (c == 0xFF)
 			return FALSE;
 		marker = c;
+		if (pos>=ImageInfo->Thumbnail.size)
+			return FALSE;
 		length = php_jpg_get16(data+pos);
 		if (length > ImageInfo->Thumbnail.size || pos >= ImageInfo->Thumbnail.size - length) {
 			return FALSE;

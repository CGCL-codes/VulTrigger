diff --git a/src/libraw_cxx.cpp b/src/libraw_cxx.cpp
index a111b9fe..294ba423 100644
--- a/src/libraw_cxx.cpp
+++ b/src/libraw_cxx.cpp
@@ -6143,12 +6143,15 @@ void LibRaw::parse_x3f()
   imgdata.sizes.raw_width = ID->columns;
   imgdata.sizes.raw_height = ID->rows;
   // Parse other params from property section
+
   DE = x3f_get_prop(x3f);
   if ((x3f_load_data(x3f, DE) == X3F_OK))
   {
     // Parse property list
     DEH = &DE->header;
     x3f_property_list_t *PL = &DEH->data_subsection.property_list;
+    utf16_t *datap = (utf16_t*) PL->data;
+    uint32_t maxitems = PL->data_size/sizeof(utf16_t);
     if (PL->property_table.size != 0)
     {
       int i;
@@ -6156,8 +6159,14 @@ void LibRaw::parse_x3f()
       for (i = 0; i < PL->num_properties; i++)
       {
         char name[100], value[100];
-        utf2char(P[i].name, name,sizeof(name));
-        utf2char(P[i].value, value,sizeof(value));
+        int noffset = (P[i].name - datap);
+        int voffset = (P[i].value - datap);
+        if(noffset < 0 || noffset>maxitems || voffset<0 || voffset>maxitems)
+           throw LIBRAW_EXCEPTION_IO_CORRUPT;
+        int maxnsize = maxitems - (P[i].name - datap);
+        int maxvsize = maxitems - (P[i].value - datap);
+        utf2char(P[i].name, name,MIN(maxnsize,sizeof(name)));
+        utf2char(P[i].value, value,MIN(maxvsize,sizeof(value)));
         if (!strcmp(name, "ISO"))
           imgdata.other.iso_speed = atoi(value);
         if (!strcmp(name, "CAMMANUF"))
